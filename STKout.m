% Functions to write satellite time, position and velocity in STK ephemeris
% format for checking purposes.

function STKout (fid, epoch, time, eciPos, eciVel)

    %Write to the specified file
    f = fopen(fid,'w'); 
    
    %Example from pg. 17 of technical specifications
    fprintf(f,'stk.v.4.3\n');
    fprintf(f,'\nBEGIN Ephemeris\n');
    fprintf(f,'\nNumberOfEphemerisPoints 570\n');
    fprintf(f,'\nScenarioEpoch %s\n', epoch);
    fprintf(f,'InterpolationMethod Lagrange\n');
    fprintf(f,'InterpolationOrder 7\n');
    fprintf(f,'CentralBody Earth\n');
    fprintf(f,'CoordinateSystem J2000\n');
    fprintf(f,'\nBEGIN SegmentBoundaryTimes\n');
    fprintf(f,'   2.90998893289423e+003\n');
    fprintf(f,'   7.61935679863377e+003\n');
    fprintf(f,'END SegmentBoundaryTimes\n');
    fprintf(f,'\nEphemerisTimePosVel\n\n');
     
    format long e;
    
    %print out in STK Ephemris format
    i=1;
    while(i<(length(time)+1))
        fprintf(f, '%0.15e %0.15e %0.15e %0.15e %0.15e %0.15e %0.15e\n', time(i), eciPos(i,1), eciPos(i,2), eciPos(i,3) , eciVel(i,1), eciVel(i,2), eciVel(i,3));
        i = i+1;
    end
     
    fprintf(f,'\nEND Ephemeris');
    
fclose(f);

%Test values

% time = [0.000000000000E+00
% 6.000000000000E+01
% 1.295828917454E+02
% 1.991440530510E+02
% 2.763823865606E+02
% 3.547346752816E+02
% 4.247638589102E+02
% 5.025922086546E+02
% 5.805092367247E+02
% 6.593605715779E+02
% 7.302995870454E+02
% 9.40193567986338e+004]
% 
% eciPos = [6.778000000000E+06 0.000000000000E+00 0.000000000000E+00;
% 6.762366571327E+06 3.302172681218E+05 3.302165677079E+05;
% 6.705192943572E+06 7.111663185412E+05 7.111590731896E+05;
% 6.606506864438E+06 1.087591661881E+06 1.087565120871E+06;
% 6.449101325083E+06 1.497583504664E+06 1.497512424606E+06;
% 6.239316127956E+06 1.901836917992E+06 1.901687243177E+06;
% 6.010549488690E+06 2.250680842730E+06 2.250425722328E+06;
% 5.712559731708E+06 2.621880213709E+06 2.621462188630E+06;
% 5.370501887156E+06 2.973435163554E+06 2.972799642530E+06;
% 4.982679254027E+06 3.306126489717E+06 3.305209982198E+06;
% 4.600617331384E+06 3.583570199328E+06 3.582344996818E+06
% 9.12307444035086e+005 -9.15066921081495e+006 -9.12896063523957e+006]
% 
% eciVel = [0.000000000000E+00 5.507860000000E+03 5.507860000000E+03;
% -5.208934333931E+02 5.495149381280E+03 5.495113852280E+03;
% -1.121497031945E+03 5.448699928364E+03 5.448530689793E+03;
% -1.714286379965E+03 5.368594292812E+03 5.368192544797E+03;
% -2.358719853183E+03 5.240991965666E+03 5.240221753481E+03;
% -2.992393332966E+03 5.071235510011E+03 5.069981970176E+03;
% -3.537384431685E+03 4.886510628464E+03 4.884739984339E+03;
% -4.114930874328E+03 4.646491599702E+03 4.644062200314E+03;
% -4.659087752158E+03 4.371808898534E+03 4.368644076919E+03;
% -5.170864459842E+03 4.061440505760E+03 4.057469216946E+03;
% -5.594686464783E+03 3.756778023918E+03 3.752040896556E+03
% 5.51555231101735e+003 5.44126355240701e+002 6.25282047804224e+002]

end
